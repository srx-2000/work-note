# 常用基础加密

## 常见编码

​	base64、latin1、utf-8、utf-16、hex

## hash算法

​	这种加密最显著的特征就是不可逆，但相同明文加密出来的密文的值是相同的，即非对称算法。

### 识别方式

​	十六进制字符串，位数固定，具有雪崩效应

### 算法说明

​	首先不论是md系列还是sha1、sha2系列，亦或是hmac hash家族，本质上都是hash算法，也可以被称为摘要算法。其本质都是将传入的message，进行padding并分组。而后初始化一系列的魔数。如的魔数为：

```bash
# md5
A=0x01234567, B=0x89ABCDEF, C=0xFEDCBA98, D=0x76543210
# sha1
A=0x67452301, B=0xefcdab89, C=0x98badcfe, D=0x10325476, E=0xc3d2e1f0s
```
​	而后将padding并分组后的message块与初始化魔数做一系列的运算。而最终的结果则是将最后一轮计算出来的魔数进行拼接。

​	所以sha系列和md5系列之所以又被称为是摘要算法，就是因为最终的计算结果并非是由最开始输入的message经过加密得到的。而是使用算法将message中的一系列特征摘要到了初始化魔数中，并在最终输出这个魔数序列的拼接值。而最终输出的特点有如下几点：

1. 最终输出一定是十六进制字符串。
2. 最终输出的位数一定是固定的，md5是32位，sha1是40位。

​	一般有以上几个特点时，就可以往对应的hash算法上去猜测了。

> 注：
>
> 1. 在padding时：MD5和sha1都是以64字节为一组进行分组
> 2. 在进行系列运算时：MD5是需要循环64次，在计算的过程中初始化魔数会不断的变化
> 3. 在最终结果拼接时：注意大小端

### 常见算法

​	MD5、SHA1、SHA2、SHA3、HmacMD5、HmacSHA1、HmacSHA256、HmacSHA512

### 详解参考

MD5：[视频](https://www.bilibili.com/video/BV1aP411M7ug)

SHA1：[视频](https://www.bilibili.com/video/BV1V14y1T7LM/)

SHA2：[视频](https://www.bilibili.com/video/BV1We4y1N7wT)

Hmac：[视频](https://www.bilibili.com/video/BV1c34y1M7NW)

## 对称加密【怀疑方式：非取盐校验常用位数+密文最大字符为f】

### 识别方式

​	存在秘钥、密文存在非十六进制字符串、密文长度随字符串增长而增长。

### 算法说明

#### AES算法

​	AES算法根据模式、padding、密文位数分为很多种类【以下仅列出遇到过的】：

> 模式划分：
>
> 1. EBC模式：最简单版本
> 2. CBC模式：有IV初始值版本
> 3. GCM模式：还未研究
>
> padding划分：
>
> 1. no-pad：输入明文长度必须为16、24、32字节长度的倍数
> 2. pkcs7：输入明文可以是任意长度，padding直接举例的话：假设明文长度为11个字节，则pkcs7会在明文后续添加5个0x05【即：凑够16的倍数】。假设明文长度为16个字节，则pkcs7会在明文后续添加16个0x10【即：如果原本长度就是16的倍数，则添加16个0x10以便与no-pad区别开来】。
>
> 密文长度：
>
> 1. AES-128
> 2. AES-192
> 3. AES-256

​	以下仅以AES-EBC模式进行说明：

##### 介绍

​	aes加密是以16、24、32个字节为一组进行加密的，其中如果不使用填充则需要明文长度为16、24、32字节的倍数，如果使用了填充，则无论明文是否为16、24、32字节的倍数都会填充【如果没到16字节倍数则填充到16字节倍数，如果本身就是16字节倍数，则填充16字节的0x10】，最常见的PKCS7填充的内容是：明文与16字节之间长度的差值。

##### 下方可能会用到的计算名词

​	 **列位移**：

```tex
[a] ===> [b]
[b] ===> [c]
[c] ===> [d]
[d] ===> [a]
```

​	**字节代换**：

​		字节代换有一个常量表，该表可以用一个字节，去查到另一个完全不同的字节，并用查到的字节替换掉原本字节。

​	**轮常量异或**:

​			轮常量异或会有一个轮常量表，该表中存放了10个非线性的字节。

​			轮常量异或这件事只会发生在轮秘钥扩展的情况一下。换句话说，也就是只会发生在[当前列]的index等于0或者nk的倍数时。
​				所以128位秘钥扩展位数为176，共有44列,nk值为4，其中前4列为输入秘钥，（44-nk）/ nk，所以共会出现10次"情况一"
​				所以192位秘钥扩展位数为208，共有52列,nk值为6，其中前6列为输入秘钥，((52-nk) / nk) + 1所以共会出现8次"情况一"
​				所以256位秘钥扩展位数为240，共有60列,nk值为8，其中前8列为输入秘钥，((60-nk) / nk) + 1所以共会出现7次"情况一"
​			轮常量异或就是看当前是第几次发生"情况一"，第一次发生情况一，就用字节代换后的列的第一个字节与轮常量表中的第一个字节进行异或。

​	**逐列元素异或**:

```tex
[a]			   [A]	  [a^A]
[b]	逐列元素异或 [B] ==> [b^B]
[c]  		   [C]	   [c^C]
```

​	**轮秘钥加**

​		[明文1，明文2，明文3] 轮秘钥加 [轮秘钥1，轮秘钥2，轮秘钥3] = [明文1^轮秘钥1，明文2^轮秘钥2，明文3^轮秘钥3]

​	**行位移**

```bash
[a1,a2,a3,a4] ===> [a1,a2,a3,a4]
[b1,b2,b3,b4] ===> [b2,b3,b4,b1]
[c1,c2,c3,c4] ===> [c3,c4,c1,c2]
[d1,d2,d3,d4] ===> [d4,d1,d2,d3]
```

​	**列混淆**

​		比较繁琐，还有待补充。GF(2^8)

##### 秘钥扩展：生成轮秘钥

​	128秘钥，需要将秘钥扩展为11*16=176位，nk值为4【就是秘钥列数】

​	192秘钥，需要将秘钥扩展为13*24=208位，nk值为6

​	256秘钥，需要将秘钥扩展为15*32=240位，nk值为8

​	其中11,13,15，来自于下面的加密器，分别加密的轮次，在128时，加密是10轮，而进入轮加密之前也有一步轮秘钥加操作，所以秘钥长度需要是11*16。

​	**情况1**：

```bash
[当前列]÷nk值余数为0【当前列从0开始算】，可以视为每一组的开头的那一列【以nk的值对列进行小组划分】。
# 也就是说计算nk列小组开头那一列的值时，要与n-1列以及前一个nk列小组开头的那一列相关。
公式：[当前列-nk值] *逐列元素异或* 轮常量异或（字节代换（列位移（[当前列-1]）））
```

​	**情况2：该情况只会出现在aes-256中**

```bash
[当前列]÷nk值余数不为0，且[当前列]÷4值余数为0【当前列从0开始算】
# 也就是说当前列的index值为4且不是8的倍数时，如12,20,28。
公式：[当前列-nk值] *逐列元素异或* （字节代换（[当前列-1]））
```

​	**情况3：**

```bash
其他，在不看aes256的情况下，这个情况就是nk列小组中除了开头那一列以外的所有列的计算方式。
公式：[当前列-nk值] *逐列元素异或* [当前列-1]
```

##### 加密器

```python
# 伪代码
轮秘钥 = 轮秘钥[0:4*nk]
A = 轮秘钥加（明文,轮秘钥）
# 128是10，192是12，256是14
for i in range(10):
    B = 字节代换（A）
    C = 行位移（B）
    D = C
    # 最后一轮不执行列混淆
    if i!=9:
        D = 列混淆（C）
    轮秘钥 = [(i+1)*4*nk:(i+2)*4*nk]
    E = 轮秘钥加（D,轮秘钥）
    A = E
```

### 常见算法

​	AES，DES，TripleDES。

## 非对称加密【怀疑方式：非取盐校验常用位数+密文最大字符为f】

​	非对称加密一般指的是RSA加密，其特点是由两种密钥进行加密和解密的。一种是公钥，另一种是私钥，与对称加密相反，非对称加密是一段明文通过公钥可以加密成不同的多个密文，而密钥则可以通过不同的密文解密出相同的明文。

## CRC循环冗余校验

详情见文档：[CRC循环冗余校验.md](./CRC循环冗余校验.md)

## 常用加密的格式判断

### JS

​	在js逆向时如果遇见了形如下图等一系列的代码基本就可以断定是成熟的某种加密【就不用傻傻的去跟栈了】：

![image-20240105175328566](基础加密及分类.assets/image-20240105175328566.png)

![2ef96310a26bf5ed1b19c2c1c3b6995](基础加密及分类.assets/2ef96310a26bf5ed1b19c2c1c3b6995.png)

![83d3b9a4c5af3de4850f0a614875726](基础加密及分类.assets/83d3b9a4c5af3de4850f0a614875726.png)

![7d37717f60aa16704d28e58a83a439d](基础加密及分类.assets/7d37717f60aa16704d28e58a83a439d.png)

![3ddd614f75b514e3375d31dbe59ba80](基础加密及分类.assets/3ddd614f75b514e3375d31dbe59ba80.png)

